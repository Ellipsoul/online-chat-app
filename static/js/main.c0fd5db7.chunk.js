(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{105:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(8),r=n.n(o),s=(n(80),n(50),n(64)),l=n(11),i=n(33),m=n(25),u=n(132),g=n(138),h=n(136),d=n(141),p=n(139),f=n(59),v=n.n(f),E=n(44),b=n.n(E),_=n(60);function j(e){var t=_.isMobile?b()(e.date).format("D/M  HH:mm"):b()(e.date).format("D MMMM YYYY  HH:mm:ss");return c.a.createElement(c.a.Fragment,null,c.a.createElement("section",{className:"message_container"},c.a.createElement("div",{className:"msg_name"}," ",e.name," "),c.a.createElement("div",{className:"msg_date"}," ",t," "),c.a.createElement("div",{className:"msg_message"}," ",e.message," ")))}function O(e){var t=Object(a.useState)(""),n=Object(m.a)(t,2),o=n[0],r=n[1],s=Object(a.useState)(0),l=Object(m.a)(s,2),f=l[0],E=l[1],b=Object(a.useRef)(f);b.current=f;var _=Object(a.useState)(0),O=Object(m.a)(_,2),w=O[0],k=O[1],y=Object(a.useRef)(w);y.current=w;var D=function(e){e.preventDefault();var t="location.state.name",n=new Date(Date.now()),a=o,s=n.getTime();if(0!==o.length&&o.length<1e3){v.a.post("https://online-chat-app-ellipsoul.herokuapp.com/api/send_message",{name:t,date:n.toString(),message:a,date_unix:s}),console.log("Message sent: ".concat(a)),r(""),k(y.current+1);var l=c.a.createElement(j,{key:y.current,name:t,date:n.toString(),message:a});return T((function(e){return[].concat(Object(i.a)(e),[l])})),E(s),!1}q(!0)};Object(a.useEffect)((function(){Y()}),[]);var N=Object(a.useState)([[]]),S=Object(m.a)(N,2),M=S[0],C=S[1],R=Object(a.useRef)(M);R.current=M;var H=Object(a.useState)([[]]),x=Object(m.a)(H,2),I=x[0],T=x[1];function Y(){fetch("https://online-chat-app-ellipsoul.herokuapp.com/api/get_all_messages",{method:"GET",mode:"cors",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("Retrieved all messages from server"),C(e.all_messages);var t=e.all_messages.length;k(y.current+t),T(e.all_messages.map((function(e,n){return c.a.createElement(j,{key:y.current-t+n,name:e[0],date:e[1],message:e[2]})})))}))}function F(){if(!R.current.length)return Y(),null;var e=parseInt(R.current[R.current.length-1][3])>b.current?R.current[R.current.length-1][3]:b.current.toString(),t="https://online-chat-app-ellipsoul.herokuapp.com/api/get_new_messages?time=".concat(e);console.log("Getting new messages with query: ".concat(t," for user ","location.state.name")),fetch(t,{method:"GET",mode:"cors",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){if(console.log("Retrieve new messages from server for user ".concat("location.state.name")),console.log("New messages are:"),console.log(e.new_messages),e.new_messages.length){C((function(t){return[].concat(Object(i.a)(t),Object(i.a)(e.new_messages))}));var t=e.new_messages.length;k(y.current+t);var n=e.new_messages.map((function(e,n){return c.a.createElement(j,{key:y.current-t+n,name:e[0],date:e[1],message:e[2]})}));T((function(e){return[].concat(Object(i.a)(e),Object(i.a)(n))}))}}))}var G=Object(a.useRef)(null);Object(a.useEffect)((function(){G.current.scrollIntoView({behavior:"smooth"})}),[I]);var W=window.innerHeight,A=Math.floor(W/200),B=Object(a.useState)(!1),J=Object(m.a)(B,2),L=J[0],q=J[1];Object(a.useEffect)((function(){var e=setInterval((function(){F()}),5e3);return function(){return clearInterval(e)}}),[]);var z=Object(a.useState)(!1),K=Object(m.a)(z,2),V=K[0],$=K[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,{maxWidth:"lg",className:"large_chat_container",disableGutters:!0},c.a.createElement("section",{className:"chat_container"},c.a.createElement("div",{className:"chat_messages_container"},c.a.createElement("div",{className:"chat_messages_div"},I,c.a.createElement("div",{ref:G}))),c.a.createElement("div",{id:"input_field_div"},c.a.createElement(g.a,{width:"100%"},c.a.createElement(h.a,{label:"Say something, ".concat("location.state.name"," :)"),fullWidth:!0,multiline:!0,rows:A,value:o,onChange:function(e){return r(e.target.value)},variant:"outlined",color:"primary",onKeyDown:function(e){"Enter"==e.key&&D(e)}}))),c.a.createElement(d.a,{color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"center"},open:L,onClose:function(){q(!1)},autoHideDuration:3e3,message:"Your message is either empty or too long!"}),c.a.createElement("div",{className:"submit_button_div"},c.a.createElement(p.a,{variant:"contained",color:"primary",className:"submit_button",onClick:D},c.a.createElement("span",{id:"submit_button_text"}," Send "))))),c.a.createElement("button",{className:"hidden_button",onClick:function(){console.log("Dev menu toggled"),$(!V)}},"D"),V?c.a.createElement("div",{className:"dev_buttons_div"},c.a.createElement("button",{onClick:function(){fetch("https://online-chat-app-ellipsoul.herokuapp.com/api/clear_messages",{method:"DELETE",mode:"cors",headers:{content_type:"application/json"}}).then((function(){console.log("All messages deleted!")}))}},"DA"),c.a.createElement("button",{onClick:function(){var e=Date.now(),t="https://online-chat-app-ellipsoul.herokuapp.com/api/clear_old_messages?time=".concat(e);fetch(t,{method:"DELETE",mode:"cors",headers:{content_type:"application/json"}}).then((function(){console.log("Old messages deleted!")}))}},"DO"),c.a.createElement("button",{onClick:Y},"RA"),c.a.createElement("button",{onClick:F},"RN")):null)}var w=function(){return console.log("Frontend is now running!"),c.a.createElement(c.a.Fragment,null,c.a.createElement(O,null),c.a.createElement(s.a,null,c.a.createElement(l.c,null,c.a.createElement(l.a,{exact:!0,path:"/chat"},c.a.createElement(O,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},50:function(e,t,n){},75:function(e,t,n){e.exports=n(105)},80:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.c0fd5db7.chunk.js.map