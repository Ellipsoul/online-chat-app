(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{50:function(e,t,n){},65:function(e,t,n){e.exports=n(78)},70:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(8),r=n.n(o),s=(n(70),n(50),n(43)),l=n(11),i=n(32),u=n(24),m=n(105),g=n(111),h=n(109),p=n(114),d=n(112),f=n(44),v=n.n(f),b=n(51);function E(e){var t=b.isMobile?v()(e.date).format("D/M  HH:mm"):v()(e.date).format("D MMMM YYYY  HH:mm:ss");return c.a.createElement(c.a.Fragment,null,c.a.createElement("section",{className:"message_container"},c.a.createElement("div",{className:"msg_name"}," ",e.name," "),c.a.createElement("div",{className:"msg_date"}," ",t," "),c.a.createElement("div",{className:"msg_message"}," ",e.message," ")))}function _(e){Object(l.f)();var t=Object(a.useState)(""),n=Object(u.a)(t,2),o=n[0],r=n[1],s=Object(a.useState)(0),f=Object(u.a)(s,2),v=f[0],b=f[1],_=Object(a.useRef)(v);_.current=v;var j=Object(a.useState)(0),O=Object(u.a)(j,2),w=O[0],y=O[1],k=Object(a.useRef)(w);k.current=w;var N=function(e){e.preventDefault();var t="location.state.name",n=new Date(Date.now()),a=o,s=n.getTime();if(0!==o.length&&o.length<1e3){fetch("https://online-chat-app-ellipsoul.herokuapp.com/api/send_message",{method:"POST",headers:{content_type:"application/json"},body:JSON.stringify({name:t,date:n.toString(),message:a,date_unix:s})}).then((function(e){return e.json()})),console.log("Message sent!"),r(""),y(k.current+1);var l=c.a.createElement(E,{key:k.current,name:t,date:n.toString(),message:a});return I((function(e){return[].concat(Object(i.a)(e),[l])})),b(s),!1}q(!0)};Object(a.useEffect)((function(){Y()}),[]);var S=Object(a.useState)([[]]),D=Object(u.a)(S,2),M=D[0],C=D[1],R=Object(a.useRef)(M);R.current=M;var H=Object(a.useState)([[]]),T=Object(u.a)(H,2),x=T[0],I=T[1];function Y(){fetch("https://online-chat-app-ellipsoul.herokuapp.com/api/get_all_messages",{method:"GET",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("Retrieved all messages from server"),C(e.all_messages);var t=e.all_messages.length;y(k.current+t),I(e.all_messages.map((function(e,n){return c.a.createElement(E,{key:k.current-t+n,name:e[0],date:e[1],message:e[2]})})))}))}function F(){if(!R.current.length)return Y(),null;var e=parseInt(R.current[R.current.length-1][3])>_.current?R.current[R.current.length-1][3]:_.current.toString(),t="https://online-chat-app-ellipsoul.herokuapp.com/api/get_new_messages?time=".concat(e);console.log("Getting new messages with query: ".concat(t," for user ","location.state.name")),fetch(t,{method:"GET",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){if(console.log("Retrieve new messages from server for user ".concat("location.state.name")),console.log("New messages are:"),console.log(e.new_messages),e.new_messages.length){C((function(t){return[].concat(Object(i.a)(t),Object(i.a)(e.new_messages))}));var t=e.new_messages.length;y(k.current+t);var n=e.new_messages.map((function(e,n){return c.a.createElement(E,{key:k.current-t+n,name:e[0],date:e[1],message:e[2]})}));I((function(e){return[].concat(Object(i.a)(e),Object(i.a)(n))}))}}))}var G=Object(a.useRef)(null);Object(a.useEffect)((function(){G.current.scrollIntoView({behavior:"smooth"})}),[x]);var W=window.innerHeight,A=Math.floor(W/200),J=Object(a.useState)(!1),B=Object(u.a)(J,2),L=B[0],q=B[1];Object(a.useEffect)((function(){var e=setInterval((function(){F()}),1e3);return function(){return clearInterval(e)}}),[]);var z=Object(a.useState)(!1),K=Object(u.a)(z,2),P=K[0],V=K[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(m.a,{maxWidth:"lg",className:"large_chat_container",disableGutters:!0},c.a.createElement("section",{className:"chat_container"},c.a.createElement("div",{className:"chat_messages_container"},c.a.createElement("div",{className:"chat_messages_div"},x,c.a.createElement("div",{ref:G}))),c.a.createElement("div",{id:"input_field_div"},c.a.createElement(g.a,{width:"100%"},c.a.createElement(h.a,{label:"Say something, ".concat("location.state.name"," :)"),fullWidth:!0,multiline:!0,rows:A,value:o,onChange:function(e){return r(e.target.value)},variant:"outlined",color:"primary",onKeyDown:function(e){"Enter"==e.key&&N(e)}}))),c.a.createElement(p.a,{color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"center"},open:L,onClose:function(){q(!1)},autoHideDuration:3e3,message:"Your message is either empty or too long!"}),c.a.createElement("div",{className:"submit_button_div"},c.a.createElement(d.a,{variant:"contained",color:"primary",className:"submit_button",onClick:N},c.a.createElement("span",{id:"submit_button_text"}," Send "))))),c.a.createElement("button",{className:"hidden_button",onClick:function(){console.log("Dev menu toggled"),V(!P)}},"D"),P?c.a.createElement("div",{className:"dev_buttons_div"},c.a.createElement("button",{onClick:function(){fetch("https://online-chat-app-ellipsoul.herokuapp.com/api/clear_messages",{method:"DELETE",headers:{content_type:"application/json"}}).then((function(){console.log("All messages deleted!")}))}},"DA"),c.a.createElement("button",{onClick:function(){var e=Date.now(),t="https://online-chat-app-ellipsoul.herokuapp.com/api/clear_old_messages?time=".concat(e);fetch(t,{method:"DELETE",headers:{content_type:"application/json"}}).then((function(){console.log("Old messages deleted!")}))}},"DO"),c.a.createElement("button",{onClick:Y},"RA"),c.a.createElement("button",{onClick:F},"RN")):null)}var j=function(){return console.log("Frontend is now running!"),c.a.createElement(c.a.Fragment,null,c.a.createElement(_,null),c.a.createElement(s.a,null,c.a.createElement(l.c,null,c.a.createElement(l.a,{exact:!0,path:"/chat"},c.a.createElement(_,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[65,1,2]]]);
//# sourceMappingURL=main.abf65877.chunk.js.map