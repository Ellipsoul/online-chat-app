(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{50:function(e,t,n){},65:function(e,t,n){e.exports=n(78)},70:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(8),o=n.n(r),s=(n(70),n(50),n(43)),l=n(11),i=n(32),m=n(24),u=n(105),g=n(111),d=n(109),f=n(114),h=n(112),v=n(44),b=n.n(v),E=n(51);function _(e){var t=E.isMobile?b()(e.date).format("D/M  HH:mm"):b()(e.date).format("D MMMM YYYY  HH:mm:ss");return c.a.createElement(c.a.Fragment,null,c.a.createElement("section",{className:"message_container"},c.a.createElement("div",{className:"msg_name"}," ",e.name," "),c.a.createElement("div",{className:"msg_date"}," ",t," "),c.a.createElement("div",{className:"msg_message"}," ",e.message," ")))}function p(e){var t=Object(l.f)(),n=Object(a.useState)(""),r=Object(m.a)(n,2),o=r[0],s=r[1],v=Object(a.useState)(0),b=Object(m.a)(v,2),E=b[0],p=b[1],j=Object(a.useRef)(E);j.current=E;var O=Object(a.useState)(0),w=Object(m.a)(O,2),y=w[0],N=w[1],S=Object(a.useRef)(y);S.current=y;var k=function(e){e.preventDefault();var n=t.state.name,a=new Date(Date.now()),r=o,l=a.getTime();if(0!==o.length&&o.length<1e3){fetch("/api/send_message",{method:"POST",headers:{content_type:"application/json"},body:JSON.stringify({name:n,date:a.toString(),message:r,date_unix:l})}).then((function(e){return e.json()})),console.log("Message sent!"),s(""),N(S.current+1);var m=c.a.createElement(_,{key:S.current,name:n,date:a.toString(),message:r});return Y((function(e){return[].concat(Object(i.a)(e),[m])})),p(l),!1}z(!0)};Object(a.useEffect)((function(){F()}),[]);var D=Object(a.useState)([[]]),M=Object(m.a)(D,2),C=M[0],R=M[1],H=Object(a.useRef)(C);H.current=C;var T=Object(a.useState)([[]]),x=Object(m.a)(T,2),I=x[0],Y=x[1];function F(){fetch("/api/get_all_messages",{method:"GET",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("Retrieved all messages from server"),R(e.all_messages);var t=e.all_messages.length;N(S.current+t),Y(e.all_messages.map((function(e,n){return c.a.createElement(_,{key:S.current-t+n,name:e[0],date:e[1],message:e[2]})})))}))}function G(){if(!H.current.length)return F(),null;var e=parseInt(H.current[H.current.length-1][3])>j.current?H.current[H.current.length-1][3]:j.current.toString(),n="/api/get_new_messages?time=".concat(e);console.log("Getting new messages with query: ".concat(n," for user ").concat(t.state.name)),fetch(n,{method:"GET",headers:{content_type:"application/json"}}).then((function(e){return e.json()})).then((function(e){if(console.log("Retrieve new messages from server for user ".concat(t.state.name)),console.log("New messages are:"),console.log(e.new_messages),e.new_messages.length){R((function(t){return[].concat(Object(i.a)(t),Object(i.a)(e.new_messages))}));var n=e.new_messages.length;N(S.current+n);var a=e.new_messages.map((function(e,t){return c.a.createElement(_,{key:S.current-n+t,name:e[0],date:e[1],message:e[2]})}));Y((function(e){return[].concat(Object(i.a)(e),Object(i.a)(a))}))}}))}var W=Object(a.useRef)(null);Object(a.useEffect)((function(){W.current.scrollIntoView({behavior:"smooth"})}),[I]);var A=window.innerHeight,J=Math.floor(A/200),B=Object(a.useState)(!1),L=Object(m.a)(B,2),q=L[0],z=L[1];Object(a.useEffect)((function(){var e=setInterval((function(){G()}),1e3);return function(){return clearInterval(e)}}),[]);var K=Object(a.useState)(!1),P=Object(m.a)(K,2),V=P[0],$=P[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,{maxWidth:"lg",className:"large_chat_container",disableGutters:!0},c.a.createElement("section",{className:"chat_container"},c.a.createElement("div",{className:"chat_messages_container"},c.a.createElement("div",{className:"chat_messages_div"},I,c.a.createElement("div",{ref:W}))),c.a.createElement("div",{id:"input_field_div"},c.a.createElement(g.a,{width:"100%"},c.a.createElement(d.a,{label:"Say something, ".concat(t.state.name," :)"),fullWidth:!0,multiline:!0,rows:J,value:o,onChange:function(e){return s(e.target.value)},variant:"outlined",color:"primary",onKeyDown:function(e){"Enter"==e.key&&k(e)}}))),c.a.createElement(f.a,{color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"center"},open:q,onClose:function(){z(!1)},autoHideDuration:3e3,message:"Your message is either empty or too long!"}),c.a.createElement("div",{className:"submit_button_div"},c.a.createElement(h.a,{variant:"contained",color:"primary",className:"submit_button",onClick:k},c.a.createElement("span",{id:"submit_button_text"}," Send "))))),c.a.createElement("button",{className:"hidden_button",onClick:function(){console.log("Dev menu toggled"),$(!V)}},"D"),V?c.a.createElement("div",{className:"dev_buttons_div"},c.a.createElement("button",{onClick:function(){fetch("/api/clear_messages",{method:"DELETE",headers:{content_type:"application/json"}}).then((function(){console.log("All messages deleted!")}))}},"DA"),c.a.createElement("button",{onClick:function(){var e=Date.now(),t="api/clear_old_messages?time=".concat(e);fetch(t,{method:"DELETE",headers:{content_type:"application/json"}}).then((function(){console.log("Old messages deleted!")}))}},"DO"),c.a.createElement("button",{onClick:F},"RA"),c.a.createElement("button",{onClick:G},"RN")):null)}var j=function(){return console.log("Frontend is now running!"),c.a.createElement(c.a.Fragment,null,c.a.createElement(p,null),c.a.createElement(s.a,null,c.a.createElement(l.c,null,c.a.createElement(l.a,{exact:!0,path:"/chat"},c.a.createElement(p,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[65,1,2]]]);
//# sourceMappingURL=main.3ba21132.chunk.js.map